<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh sách đợt giảm giá</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <title>Danh sách thương hiệu</title>
    <link rel="stylesheet" href="/adminlte/pagination/simplePagination.css">
    <link rel="stylesheet" href="/adminlte/css/custom.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</head>

<body>
<div class="container mt-5">
    <h2 class="text-center">Danh sách đợt giảm giá</h2>
    <table class="table table-bordered table-hover mt-3">
        <thead>
        <tr>
            <th>STT</th>
            <th>Tên đợt</th>
            <th>Giá trị</th>
            <th>Loại giảm giá</th>
            <th>Gia tri giam toi da</th>
            <th>Trạng thái</th>
            <th>Thời gian bắt đầu</th>
            <th>Thời gian kết thúc</th>
            <th>Ngày tạo</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <th:block th:each="dotGiamGia : ${dgg}">
            <tr>
                <td th:text="${dotGiamGia.id}"></td>
                <td th:text="${dotGiamGia.ten_dot}"></td>
                <td th:text="${dotGiamGia.gia_tri}"></td>
                <td th:text="${dotGiamGia.loai_giam_gia}"></td>
                <td th:text="${dotGiamGia.gia_tri_giam_toi_da}"></td>
                <td th:text="${dotGiamGia.trang_thai ? 'Đang áp dụng' : 'Ngừng'}"></td>
                <td th:text="${#dates.format(dotGiamGia.thoi_gian_bat_dau, 'dd-MM-yyyy HH:mm')}"></td>
                <td th:text="${#dates.format(dotGiamGia.thoi_gian_ket_thuc, 'dd-MM-yyyy HH:mm')}"></td>
                <td th:text="${#dates.format(dotGiamGia.ngay_tao, 'dd-MM-yyyy HH:mm')}"></td>

                <td>
                    <a th:href="@{'/update?id=' + ${dotGiamGia.id}}" class="btn btn-warning btn-sm">Sửa</a>
                    <a href="#" class="xoa-dgg" th:data-id="${dotGiamGia.id}"><i
                            class="far fa-trash-alt"></i></a>
                </td>
            </tr>
        </th:block>
        </tbody>
    </table>
    <a href="/form-add" class="btn btn-success">Thêm mới đợt giảm giá</a>
    <script>
        $(document).on('click', '.xoa-dgg', function () {
            const id = $(this).data('id');

            if (confirm('Bạn có chắc chắn muốn xóa đợt giảm giá này?')) {
                $.ajax({
                    url: `/delete/${id}`, // Update the API endpoint to the correct one for deleting đợt giảm giá
                    type: 'DELETE',
                    success: function (response) {
                        alert('Đợt giảm giá đã được xóa thành công.'); // Notify the user of success
                        location.reload(); // Reload the page to see the updated list
                    },
                    error: function (xhr) {
                        alert('Có lỗi xảy ra khi xóa đợt giảm giá. Vui lòng thử lại.'); // Notify the user of an error
                        console.error(xhr.responseText); // Log the error for debugging
                    }
                });
            }
        });
    </script>
</div>
</body>
</html>
