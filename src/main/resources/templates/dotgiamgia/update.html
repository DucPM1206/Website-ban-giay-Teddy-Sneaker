<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Danh sách thương hiệu</title>
    <link rel="stylesheet" href="/adminlte/pagination/simplePagination.css">
    <link rel="stylesheet" href="/adminlte/css/custom.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

<!-- Modal thêm hoặc cập nhật đợt giảm giá-->
<div class="container mt-5">
    <h2 id="formTitle">Thêm Đợt Giảm Giá</h2>
    <form id="dotGiamGiaForm">
        <input type="hidden" id="id" /> <!-- Trường ẩn cho ID -->
        <div class="form-group">
            <label for="ten_dot">Tên Đợt Giảm Giá</label>
            <input type="text" class="form-control" id="ten_dot" placeholder="Nhập tên đợt giảm giá" required>
        </div>
        <div class="form-group">
            <label for="gia_tri">Giá Trị</label>
            <input type="number" class="form-control" id="gia_tri" placeholder="Nhập giá trị giảm giá" required>
        </div>
        <div class="form-group">
            <label for="loai_giam_gia">Loại Giảm Giá</label>
            <select class="form-control" id="loai_giam_gia">
                <option value="Phần trăm">Phần trăm</option>
                <option value="Số tiền">Số tiền</option>
            </select>
        </div>
        <div class="form-group">
            <label for="gia_tri_giam_toi_da">Giá Trị Giảm Tối Đa</label>
            <input type="number" class="form-control" id="gia_tri_giam_toi_da" placeholder="Nhập giá trị giảm tối đa" required>
        </div>
        <div class="form-group">
            <label for="trang_thai">Trạng Thái</label>
            <select class="form-control" id="trang_thai">
                <option value="true">Hoạt động</option>
                <option value="false">Ngừng hoạt động</option>
            </select>
        </div>
        <div class="form-group">
            <label for="thoi_gian_bat_dau">Thời Gian Bắt Đầu</label>
            <input type="date" class="form-control" id="thoi_gian_bat_dau" required>
        </div>
        <div class="form-group">
            <label for="thoi_gian_ket_thuc">Thời Gian Kết Thúc</label>
            <input type="date" class="form-control" id="thoi_gian_ket_thuc" required>
        </div>
        <button type="submit" class="btn btn-primary" id="submitButton">Thêm Đợt Giảm Giá</button>
        <a href="/list" class="btn btn-secondary">Trở về</a>
    </form>
    <div id="successMessage" class="alert alert-success mt-3" style="display: none;">Thêm/Cập nhật đợt giảm giá thành công!</div>
    <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;">Có lỗi xảy ra, vui lòng thử lại!</div>
</div>

<script>
    document.getElementById('dotGiamGiaForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const data = {
            id: document.getElementById('id').value, // Lấy ID nếu có
            ten_dot: document.getElementById('ten_dot').value,
            gia_tri: document.getElementById('gia_tri').value,
            loai_giam_gia: document.getElementById('loai_giam_gia').value,
            gia_tri_giam_toi_da: document.getElementById('gia_tri_giam_toi_da').value,
            trang_thai: document.getElementById('trang_thai').value === 'true',
            thoi_gian_bat_dau: document.getElementById('thoi_gian_bat_dau').value,
            thoi_gian_ket_thuc: document.getElementById('thoi_gian_ket_thuc').value,
            ngay_tao: new Date().toISOString().split('T')[0]
        };

        const endpoint = data.id ? `http://localhost:8080/update/${data.id}` : 'http://localhost:8080/add'; // Cập nhật nếu có ID

        fetch(endpoint, {
            method: data.id ? 'PUT' : 'POST', // Sử dụng PUT cho cập nhật
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(response => {
                if (response.ok) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('dotGiamGiaForm').reset();
                    document.getElementById('id').value = ''; // Reset ID
                    document.getElementById('formTitle').innerText = 'Thêm Đợt Giảm Giá'; // Reset tiêu đề
                    document.getElementById('submitButton').innerText = 'Thêm Đợt Giảm Giá'; // Reset nút
                } else {
                    throw new Error('Có lỗi xảy ra');
                }
            })
            .catch(error => {
                document.getElementById('errorMessage').style.display = 'block';
            });
    });

    // Hàm để nạp dữ liệu vào form khi cần cập nhật
    function loadDataToUpdate(id, ten_dot, gia_tri, loai_giam_gia, gia_tri_giam_toi_da, trang_thai, thoi_gian_bat_dau, thoi_gian_ket_thuc) {
        document.getElementById('id').value = id;
        document.getElementById('ten_dot').value = ten_dot;
        document.getElementById('gia_tri').value = gia_tri;
        document.getElementById('loai_giam_gia').value = loai_giam_gia;
        document.getElementById('gia_tri_giam_toi_da').value = gia_tri_giam_toi_da;
        document.getElementById('trang_thai').value = trang_thai;
        document.getElementById('thoi_gian_bat_dau').value = thoi_gian_bat_dau;
        document.getElementById('thoi_gian_ket_thuc').value = thoi_gian_ket_thuc;
        document.getElementById('formTitle').innerText = 'Cập Nhật Đợt Giảm Giá'; // Thay đổi tiêu đề
        document.getElementById('submitButton').innerText = 'Cập Nhật Đợt Giảm Giá'; // Thay đổi nút
    }
</script>
</body>
</html>
