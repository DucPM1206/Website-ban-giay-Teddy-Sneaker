<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Danh sách thương hiệu</title>
    <link rel="stylesheet" href="/adminlte/pagination/simplePagination.css">
    <link rel="stylesheet" href="/adminlte/css/custom.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

<!-- Modal thêm hoặc cập nhật đợt giảm giá-->
<div class="container mt-5">
    <h2 id="formTitle">Cập nhật Đợt Giảm Giá</h2>
    <form id="dotGiamGiaForm">
        <input type="hidden" id="id" /> <!-- Trường ẩn cho ID -->
        <div class="form-group">
            <label for="ten_dot">Tên Đợt Giảm Giá</label>
            <input type="text" class="form-control" id="ten_dot" placeholder="Nhập tên đợt giảm giá" required>
        </div>
        <div class="form-group">
            <label for="gia_tri">Giá Trị</label>
            <input type="number" class="form-control" id="gia_tri" placeholder="Nhập giá trị giảm giá" required>
        </div>
        <div class="form-group">
            <label for="loai_giam_gia">Loại Giảm Giá</label>
            <select class="form-control" id="loai_giam_gia">
                <option value="Phần trăm">Phần trăm</option>
                <option value="Số tiền">Số tiền</option>
            </select>
        </div>
        <div class="form-group">
            <label for="gia_tri_giam_toi_da">Giá Trị Giảm Tối Đa</label>
            <input type="number" class="form-control" id="gia_tri_giam_toi_da" placeholder="Nhập giá trị giảm tối đa" required>
        </div>
        <div class="form-group">
            <label for="trang_thai">Trạng Thái</label>
            <select class="form-control" id="trang_thai">
                <option value="true">Hoạt động</option>
                <option value="false">Ngừng hoạt động</option>
            </select>
        </div>
        <div class="form-group">
            <label for="thoi_gian_bat_dau">Thời Gian Bắt Đầu</label>
            <input type="date" class="form-control" id="thoi_gian_bat_dau" required>
        </div>
        <div class="form-group">
            <label for="thoi_gian_ket_thuc">Thời Gian Kết Thúc</label>
            <input type="date" class="form-control" id="thoi_gian_ket_thuc" required>
        </div>
        <button type="submit" class="btn btn-primary" id="submitButton">Cập nhật Đợt Giảm Giá</button>
        <a href="/list" class="btn btn-secondary">Trở về</a>
    </form>
    <div id="successMessage" class="alert alert-success mt-3" style="display: none;">Cập nhật đợt giảm giá thành công!</div>
    <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;">Có lỗi xảy ra, vui lòng thử lại!</div>
</div>
<script>
    // Xử lý khi form được submit (cập nhật đợt giảm giá)
    $('#dotGiamGiaForm').submit(function (e) {
        e.preventDefault();

        const id = $('#id').val();
        const tenDot = $('#ten_dot').val();
        const giaTri = $('#gia_tri').val();
        const loaiGiamGia = $('#loai_giam_gia').val();
        const giaTriGiamToiDa = $('#gia_tri_giam_toi_da').val();
        const trangThai = $('#trang_thai').val() === "true";
        const thoiGianBatDau = $('#thoi_gian_bat_dau').val();
        const thoiGianKetThuc = $('#thoi_gian_ket_thuc').val();

        // Gửi yêu cầu cập nhật qua AJAX
        $.ajax({
            url: `/update/${id}`, // Đổi endpoint phù hợp với backend của bạn
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify({
                id: id,
                ten_dot: tenDot,
                gia_tri: giaTri,
                loai_giam_gia: loaiGiamGia,
                gia_tri_giam_toi_da: giaTriGiamToiDa,
                trang_thai: trangThai,
                thoi_gian_bat_dau: thoiGianBatDau,
                thoi_gian_ket_thuc: thoiGianKetThuc
            }),
            success: function (response) {
                // Hiển thị thông báo thành công
                $('#successMessage').show();
                $('#errorMessage').hide();
                setTimeout(function () {
                    location.reload(); // Tự động tải lại trang
                }, 2000); // Tải lại sau 2 giây
            },
            error: function (xhr) {
                // Hiển thị thông báo lỗi
                $('#errorMessage').show();
                $('#successMessage').hide();
                console.error(xhr.responseText); // Ghi log lỗi để debug
            }
        });
    });
</script>

</body>
</html>
